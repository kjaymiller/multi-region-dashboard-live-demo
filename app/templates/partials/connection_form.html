<!-- Database Connection Form -->
<div class="connection-form">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="mb-0">Add Database Connection</h6>
        <button type="button" class="btn-close" onclick="document.getElementById('connection-form-container').style.display='none';"></button>
    </div>
    
    <form id="connection-form"
          hx-post="/api/db/connections"
          hx-target="#form-result"
          hx-swap="innerHTML">
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="name" class="form-label">Connection Name *</label>
                <input type="text" class="form-control" id="name" name="name" required
                       placeholder="e.g., Production PostgreSQL">
            </div>
            <div class="col-md-6 mb-3">
                <label for="host" class="form-label">Host *</label>
                <input type="text" class="form-control" id="host" name="host" required
                       placeholder="e.g., your-db.aivencloud.com">
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-3 mb-3">
                <label for="port" class="form-label">Port *</label>
                <input type="number" class="form-control" id="port" name="port" required
                       value="5432" min="1" max="65535">
            </div>
            <div class="col-md-4 mb-3">
                <label for="database" class="form-label">Database *</label>
                <input type="text" class="form-control" id="database" name="database" required
                       placeholder="e.g., myapp_prod">
            </div>
            <div class="col-md-5 mb-3">
                <label for="username" class="form-label">Username *</label>
                <input type="text" class="form-control" id="username" name="username" required
                       placeholder="e.g., myapp_user">
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="password" class="form-label">Password *</label>
                <input type="password" class="form-control" id="password" name="password" required>
                <div class="form-text">Password will be encrypted and stored securely</div>
            </div>
            <div class="col-md-3 mb-3">
                <label for="ssl_mode" class="form-label">SSL Mode</label>
                <select class="form-select" id="ssl_mode" name="ssl_mode">
                    <option value="require">Require</option>
                    <option value="prefer">Prefer</option>
                    <option value="disable">Disable</option>
                </select>
            </div>
            <div class="col-md-3 mb-3">
                <label for="region" class="form-label">Region</label>
                <select class="form-select" id="region" name="region">
                    <option value="">Select Region</option>
                    <optgroup label="AWS Regions">
                        <option value="us-east-1">us-east-1 (N. Virginia)</option>
                        <option value="us-east-2">us-east-2 (Ohio)</option>
                        <option value="us-west-1">us-west-1 (N. California)</option>
                        <option value="us-west-2">us-west-2 (Oregon)</option>
                        <option value="us-central-1">us-central-1 (Illinois)</option>
                        <option value="ca-central-1">ca-central-1 (Canada)</option>
                        <option value="eu-west-1">eu-west-1 (Ireland)</option>
                        <option value="eu-west-2">eu-west-2 (London)</option>
                        <option value="eu-central-1">eu-central-1 (Frankfurt)</option>
                        <option value="eu-north-1">eu-north-1 (Stockholm)</option>
                        <option value="eu-south-1">eu-south-1 (Italy)</option>
                        <option value="ap-southeast-1">ap-southeast-1 (Singapore)</option>
                        <option value="ap-southeast-2">ap-southeast-2 (Sydney)</option>
                        <option value="ap-northeast-1">ap-northeast-1 (Tokyo)</option>
                        <option value="ap-northeast-2">ap-northeast-2 (Seoul)</option>
                        <option value="ap-south-1">ap-south-1 (Mumbai)</option>
                        <option value="me-south-1">me-south-1 (Bahrain)</option>
                        <option value="af-south-1">af-south-1 (Cape Town)</option>
                        <option value="sa-east-1">sa-east-1 (São Paulo)</option>
                    </optgroup>
                    <optgroup label="GCP Regions">
                        <option value="us-central1">us-central1 (Iowa)</option>
                        <option value="us-east1">us-east1 (S. Carolina)</option>
                        <option value="us-west1">us-west1 (Oregon)</option>
                        <option value="us-west2">us-west2 (Los Angeles)</option>
                        <option value="europe-west1">europe-west1 (Belgium)</option>
                        <option value="europe-west2">europe-west2 (London)</option>
                        <option value="europe-west3">europe-west3 (Frankfurt)</option>
                        <option value="europe-west4">europe-west4 (Netherlands)</option>
                        <option value="asia-southeast1">asia-southeast1 (Singapore)</option>
                        <option value="asia-northeast1">asia-northeast1 (Tokyo)</option>
                        <option value="asia-northeast2">asia-northeast2 (Seoul)</option>
                        <option value="asia-south1">asia-south1 (Mumbai)</option>
                        <option value="australia-southeast1">australia-southeast1 (Sydney)</option>
                    </optgroup>
                    <optgroup label="Azure Regions">
                        <option value="eastus">eastus (Virginia)</option>
                        <option value="westus">westus (California)</option>
                        <option value="centralus">centralus (Iowa)</option>
                        <option value="westeurope">westeurope (Netherlands)</option>
                        <option value="northeurope">northeurope (Ireland)</option>
                        <option value="southeastasia">southeastasia (Singapore)</option>
                        <option value="eastasia">eastasia (Hong Kong)</option>
                        <option value="australiaeast">australiaeast (Sydney)</option>
                        <option value="brazilsouth">brazilsouth (São Paulo)</option>
                    </optgroup>
                    <optgroup label="Aiven Regions">
                        <option value="aws-eu-west-1">aws-eu-west-1 (Ireland)</option>
                        <option value="aws-us-east-1">aws-us-east-1 (Virginia)</option>
                        <option value="aws-us-west-2">aws-us-west-2 (Oregon)</option>
                        <option value="gcp-europe-west1">gcp-europe-west1 (Belgium)</option>
                        <option value="gcp-us-central1">gcp-us-central1 (Iowa)</option>
                        <option value="do-nyc1">do-nyc1 (NYC)</option>
                        <option value="do-ams1">do-ams1 (Amsterdam)</option>
                    </optgroup>
                </select>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="cloud_provider" class="form-label">Cloud Provider</label>
                <select class="form-select" id="cloud_provider" name="cloud_provider">
                    <option value="">Select Provider</option>
                    <option value="Aiven">Aiven</option>
                    <option value="AWS">AWS</option>
                    <option value="GCP">GCP</option>
                    <option value="Azure">Azure</option>
                    <option value="DigitalOcean">DigitalOcean</option>
                    <option value="Other">Other</option>
                </select>
            </div>
        </div>
        
        <div class="d-flex justify-content-between align-items-center">
            <button type="submit" class="btn btn-primary">
                <span class="htmx-indicator spinner-border spinner-border-sm me-2"></span>
                Save Connection
            </button>
            <button type="button" 
                    class="btn btn-secondary"
                    onclick="document.getElementById('connection-form-container').style.display='none';">
                Cancel
            </button>
        </div>
    </form>
    
    <div id="form-result"></div>
</div>

<script>
    // Show form when it's loaded
    document.getElementById('connection-form-container').style.display = 'block';

    // Listen for connection creation events
    document.body.addEventListener('connection-created', function() {
        // Hide the form - the container will auto-refresh via hx-trigger
        document.getElementById('connection-form-container').style.display = 'none';
    });

    document.body.addEventListener('connection-test-failed', function() {
        // Hide the form even on test failure - connection was saved
        document.getElementById('connection-form-container').style.display = 'none';
    });

    document.body.addEventListener('connection-error', function() {
        // Keep form open on error
        console.log('Connection creation failed');
    });
</script>